/*! Fabric.js Copyright 2008-2013, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.2.0"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply){fabric.log=function(){return console.log.apply(console,arguments)}}if(typeof console.warn!=="undefined"&&console.warn.apply){fabric.warn=function(){return console.warn.apply(console,arguments)}}}(function(){function c(d,e){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var f in d){this.on(f,d[f])}}else{if(!this.__eventListeners[d]){this.__eventListeners[d]=[]}this.__eventListeners[d].push(e)}}function a(d,e){if(!this.__eventListeners){this.__eventListeners={}}if(this.__eventListeners[d]){if(e){fabric.util.removeFromArray(this.__eventListeners[d],e)}else{this.__eventListeners[d].length=0}}}function b(f,g){if(!this.__eventListeners){this.__eventListeners={}}var e=this.__eventListeners[f];if(!e){return}for(var h=0,d=e.length;h<d;h++){e[h](g||{})}}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=arguments.length;a--;){this._onObjectAdded(arguments[a])}this.renderOnAddition&&this.renderAll();return this},insertAt:function(b,a,d){var c=this.getObjects();if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded(b);this.renderOnAddition&&this.renderAll();return this},remove:function(b){var c=this.getObjects();var a=c.indexOf(b);if(a!==-1){c.splice(a,1);this._onObjectRemoved(b)}this.renderAll&&this.renderAll();return b},forEachObject:function(d,b){var c=this.getObjects(),a=c.length;while(a--){d.call(b,c[a],a,c)}return this},item:function(a){return this.getObjects()[a]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)},toGrayscale:function(){return this.forEachObject(function(a){a.toGrayscale()})}};(function(){var F=Math.sqrt,c=Math.atan2;fabric.util={};function r(I,H){var G=I.indexOf(H);if(G!==-1){I.splice(G,1)}return I}function h(H,G){return Math.floor(Math.random()*(G-H+1))+H}var a=Math.PI/180;function v(G){return G*a}function o(G){return G/a}function k(G,I,M){var H=Math.sin(M),K=Math.cos(M);G.subtractEquals(I);var L=G.x*K-G.y*H;var J=G.x*H+G.y*K;return new fabric.Point(L,J).addEquals(I)}function t(H,G){return parseFloat(Number(H).toFixed(G))}function q(){return false}function i(R){R||(R={});var H=+new Date(),J=R.duration||500,P=H+J,I,M=R.onChange||function(){},K=R.abort||function(){return false},N=R.easing||function(T,S,V,U){return -V*Math.cos(T/U*(Math.PI/2))+V+S},G="startValue" in R?R.startValue:0,O="endValue" in R?R.endValue:100,Q=R.byValue||O-G;R.onStart&&R.onStart();(function L(){I=+new Date();var S=I>P?J:(I-H);M(N(S,G,Q,J));if(I>P||K()){R.onComplete&&R.onComplete();return}g(L)})()}var w=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(G){fabric.window.setTimeout(G,1000/60)};var g=function(){return w.apply(fabric.window,arguments)};function C(G){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(G))]}function d(H,J,I){if(H){var G=fabric.util.createImage();G.onload=function(){J&&J.call(I,G);G=G.onload=null};G.src=H}else{J&&J.call(I,H)}}function n(I,L){function H(){if(++K===G){if(L){L(J)}}}var J=[],K=0,G=I.length;I.forEach(function(O,N){if(!O.type){return}var M=fabric.util.getKlass(O.type);if(M.async){M.fromObject(O,function(Q,P){if(!P){J[N]=Q}H()})}else{J[N]=M.fromObject(O);H()}})}function A(I,H,J){var G;if(I.length>1){G=new fabric.PathGroup(I,H)}else{G=I[0]}if(typeof J!=="undefined"){G.setSourcePath(J)}return G}function s(K,H,J){if(J&&Object.prototype.toString.call(J)==="[object Array]"){for(var I=0,G=J.length;I<G;I++){if(J[I] in K){H[J[I]]=K[J[I]]}}}}function m(P,N,K,G,L,R){var S=G-N,Q=L-K,I=F(S*S+Q*Q),H=c(Q,S),O=R.length,J=0,M=true;P.save();P.translate(N,K);P.moveTo(0,0);P.rotate(H);N=0;while(I>N){N+=R[J++%O];if(N>I){N=I}P[M?"lineTo":"moveTo"](N,0);M=!M}P.restore()}function f(G){G||(G=fabric.document.createElement("canvas"));if(!G.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(G)}return G}function E(){return fabric.isLikelyNode?new (require("canvas").Image)():fabric.document.createElement("img")}function b(G){var K=G.prototype;for(var I=K.stateProperties.length;I--;){var L=K.stateProperties[I],M=L.charAt(0).toUpperCase()+L.slice(1),H="set"+M,J="get"+M;if(!K[J]){K[J]=(function(N){return new Function('return this.get("'+N+'")')})(L)}if(!K[H]){K[H]=(function(N){return new Function("value",'return this.set("'+N+'", value)')})(L)}}}function p(H,G){G.save();G.beginPath();H.clipTo(G);G.clip()}function y(J,H){var N=[[J[0],J[2],J[4]],[J[1],J[3],J[5]],[0,0,1]];var M=[[H[0],H[2],H[4]],[H[1],H[3],H[5]],[0,0,1]];var O=[];for(var G=0;G<3;G++){O[G]=[];for(var L=0;L<3;L++){var K=0;for(var I=0;I<3;I++){K+=N[G][I]*M[I][L]}O[G][L]=K}}return[O[0][0],O[1][0],O[0][1],O[1][1],O[0][2],O[1][2]]}function l(G){return(String(G).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]}function j(T,P,N,O){var I=O[0];var G=O[1];var J=O[2];var R=O[3];var S=O[4];var M=O[5];var L=O[6];var H=z(M,L,I,G,R,S,J,P,N);for(var K=0;K<H.length;K++){var Q=B.apply(this,H[K]);T.bezierCurveTo.apply(T,Q)}}var x={},u={},e=Array.prototype.join,D;function z(ah,ag,ac,ab,X,ad,U,aa,Z){D=e.call(arguments);if(x[D]){return x[D]}var H=U*(Math.PI/180);var ak=Math.sin(H);var ao=Math.cos(H);ac=Math.abs(ac);ab=Math.abs(ab);var O=ao*(aa-ah)*0.5+ak*(Z-ag)*0.5;var N=ao*(Z-ag)*0.5-ak*(aa-ah)*0.5;var S=(O*O)/(ac*ac)+(N*N)/(ab*ab);if(S>1){S=Math.sqrt(S);ac*=S;ab*=S}var af=ao/ac;var ae=ak/ac;var R=(-ak)/ab;var Q=(ao)/ab;var V=af*aa+ae*Z;var G=R*aa+Q*Z;var T=af*ah+ae*ag;var ap=R*ah+Q*ag;var an=(T-V)*(T-V)+(ap-G)*(ap-G);var ai=1/an-0.25;if(ai<0){ai=0}var M=Math.sqrt(ai);if(ad===X){M=-M}var aj=0.5*(V+T)-M*(ap-G);var Y=0.5*(G+ap)+M*(T-V);var L=Math.atan2(G-Y,V-aj);var K=Math.atan2(ap-Y,T-aj);var am=K-L;if(am<0&&ad===1){am+=2*Math.PI}else{if(am>0&&ad===0){am-=2*Math.PI}}var P=Math.ceil(Math.abs(am/(Math.PI*0.5+0.001)));var W=[];for(var al=0;al<P;al++){var J=L+al*am/P;var I=L+(al+1)*am/P;W[al]=[aj,Y,J,I,ac,ab,ak,ao]}x[D]=W;return W}function B(L,I,T,R,N,M,J,S){D=e.call(arguments);if(u[D]){return u[D]}var Z=S*N;var Y=-J*M;var P=J*N;var O=S*M;var U=0.5*(R-T);var Q=(8/3)*Math.sin(U*0.5)*Math.sin(U*0.5)/Math.sin(U);var X=L+Math.cos(T)-Q*Math.sin(T);var K=I+Math.sin(T)+Q*Math.cos(T);var V=L+Math.cos(R);var G=I+Math.sin(R);var W=V+Q*Math.sin(R);var H=G-Q*Math.cos(R);u[D]=[Z*X+Y*K,P*X+O*K,Z*W+Y*H,P*W+O*H,Z*V+Y*G,P*V+O*G];return u[D]}fabric.util.removeFromArray=r;fabric.util.degreesToRadians=v;fabric.util.radiansToDegrees=o;fabric.util.rotatePoint=k;fabric.util.toFixed=t;fabric.util.getRandomInt=h;fabric.util.falseFunction=q;fabric.util.animate=i;fabric.util.requestAnimFrame=g;fabric.util.getKlass=C;fabric.util.loadImage=d;fabric.util.enlivenObjects=n;fabric.util.groupSVGElements=A;fabric.util.populateWithProperties=s;fabric.util.drawDashedLine=m;fabric.util.createCanvasElement=f;fabric.util.createImage=E;fabric.util.createAccessors=b;fabric.util.clipContext=p;fabric.util.multiplyTransformMatrices=y;fabric.util.getFunctionBody=l;fabric.util.drawArc=j})();(function(){var d=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g){if(this===void 0||this===null){throw new TypeError()}var h=Object(this),e=h.length>>>0;if(e===0){return -1}var i=0;if(arguments.length>0){i=Number(arguments[1]);if(i!==i){i=0}else{if(i!==0&&i!==Number.POSITIVE_INFINITY&&i!==Number.NEGATIVE_INFINITY){i=(i>0||-1)*Math.floor(Math.abs(i))}}}if(i>=e){return -1}var f=i>=0?i:Math.max(e-Math.abs(i),0);for(;f<e;f++){if(f in h&&h[f]===g){return f}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this){h.call(g,this[f],f,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(j,h){var f=[];for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){f[g]=j.call(h,this[g],g,this)}}return f}}if(!Array.prototype.every){Array.prototype.every=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&!h.call(g,this[f],f,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(h,g){for(var f=0,e=this.length>>>0;f<e;f++){if(f in this&&h.call(g,this[f],f,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(j,h){var f=[],k;for(var g=0,e=this.length>>>0;g<e;g++){if(g in this){k=this[g];if(j.call(h,k,g,this)){f.push(k)}}}return f}}if(!Array.prototype.reduce){Array.prototype.reduce=function(g){var e=this.length>>>0,f=0,h;if(arguments.length>1){h=arguments[1]}else{do{if(f in this){h=this[f++];break}if(++f>=e){throw new TypeError()}}while(true)}for(;f<e;f++){if(f in this){h=g.call(null,h,this[f],f,this)}}return h}}function b(k,j){var g=d.call(arguments,2),f=[];for(var h=0,e=k.length;h<e;h++){f[h]=g.length?k[h][j].apply(k[h],g):k[h][j].call(k[h])}return f}function a(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]>=e){e=h[f][g]}}}else{while(f--){if(h[f]>=e){e=h[f]}}}return e}function c(h,g){if(!h||h.length===0){return undefined}var f=h.length-1,e=g?h[f][g]:h[f];if(g){while(f--){if(h[f][g]<e){e=h[f][g]}}}else{while(f--){if(h[f]<e){e=h[f]}}}return e}fabric.util.array={invoke:b,min:c,max:a}})();(function(){function b(c,e){for(var d in e){c[d]=e[d]}return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d){return d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}());(function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(d){var g=this,e=c.call(arguments,1),f;if(e.length){f=function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}}else{f=function(){return a.call(g,this instanceof b?this:d,arguments)}}b.prototype=this.prototype;f.prototype=new b();return f}}})();(function(){var g=Array.prototype.slice,f=function(){};var d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})();var c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=this.constructor.superclass.prototype[h];return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){function g(r){var v=Array.prototype.slice.call(arguments,1),u,s,q=v.length;for(s=0;s<q;s++){u=typeof r[v[s]];if(!(/^(?:function|object|unknown)$/).test(u)){return false}}return true}var d=(function(){var q=0;return function(r){return r.__uniqueID||(r.__uniqueID="uniqueID__"+q++)}})();var e,c;(function(){var q={};e=function(r){return q[r]};c=function(s,r){q[s]=r}})();function h(q,r){return{handler:r,wrappedHandler:k(q,r)}}function k(q,r){return function(s){r.call(e(q),s||fabric.window.event)}}function i(r,q){return function(v){if(f[r]&&f[r][q]){var t=f[r][q];for(var u=0,s=t.length;u<s;u++){t[u].call(this,v||fabric.window.event)}}}}var n=(g(fabric.document.documentElement,"addEventListener","removeEventListener")&&g(fabric.window,"addEventListener","removeEventListener")),l=(g(fabric.document.documentElement,"attachEvent","detachEvent")&&g(fabric.window,"attachEvent","detachEvent")),m={},f={},b,j;if(n){b=function(r,q,s){r.addEventListener(q,s,false)};j=function(r,q,s){r.removeEventListener(q,s,false)}}else{if(l){b=function(s,q,t){var r=d(s);c(r,s);if(!m[r]){m[r]={}}if(!m[r][q]){m[r][q]=[]}var u=h(r,t);m[r][q].push(u);s.attachEvent("on"+q,u.wrappedHandler)};j=function(u,r,v){var t=d(u),w;if(m[t]&&m[t][r]){for(var s=0,q=m[t][r].length;s<q;s++){w=m[t][r][s];if(w&&w.handler===v){u.detachEvent("on"+r,w.wrappedHandler);m[t][r][s]=null}}}}}else{b=function(s,q,t){var r=d(s);if(!f[r]){f[r]={}}if(!f[r][q]){f[r][q]=[];var u=s["on"+q];if(u){f[r][q].push(u)}s["on"+q]=i(r,q)}f[r][q].push(t)};j=function(v,s,w){var u=d(v);if(f[u]&&f[u][s]){var r=f[u][s];for(var t=0,q=r.length;t<q;t++){if(r[t]===w){r.splice(t,1)}}}}}}fabric.util.addListener=b;fabric.util.removeListener=j;function p(r,x){r||(r=fabric.window.event);var w=r.target||(typeof r.srcElement!=="unknown"?r.srcElement:null),y=fabric.document.body||{scrollLeft:0,scrollTop:0},t=fabric.document.documentElement,v=w,u=0,s=0,q;while(w&&w.parentNode&&!q){w=w.parentNode;if(w!==fabric.document&&fabric.util.getElementStyle(w,"position")==="fixed"){q=w}if(w!==fabric.document&&v!==x&&fabric.util.getElementStyle(w,"position")==="absolute"){u=0;s=0}else{if(w===fabric.document&&v!==x){u=y.scrollLeft||t.scrollLeft||0;s=y.scrollTop||t.scrollTop||0}else{u+=w.scrollLeft||0;s+=w.scrollTop||0}}}return{x:a(r)+u,y:o(r)+s}}var a=function(q){return(typeof q.clientX!=="unknown"?q.clientX:0)};var o=function(q){return(typeof q.clientY!=="unknown"?q.clientY:0)};if(fabric.isTouchSupported){a=function(q){if(q.type!=="touchend"){return(q.touches&&q.touches[0]?(q.touches[0].pageX-(q.touches[0].pageX-q.touches[0].clientX))||q.clientX:q.clientX)}return(q.changedTouches&&q.changedTouches[0]?(q.changedTouches[0].pageX-(q.changedTouches[0].pageX-q.changedTouches[0].clientX))||q.clientX:q.clientX)};o=function(q){if(q.type!=="touchend"){return(q.touches&&q.touches[0]?(q.touches[0].pageY-(q.touches[0].pageY-q.touches[0].clientY))||q.clientY:q.clientY)}return(q.changedTouches&&q.changedTouches[0]?(q.changedTouches[0].pageY-(q.changedTouches[0].pageY-q.changedTouches[0].clientY))||q.clientY:q.clientY)}}fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var i=Array.prototype.slice;function h(k){return typeof k==="string"?fabric.document.getElementById(k):k}var b=function(k){return i.call(k,0)};var j;try{j=b(fabric.document.childNodes) instanceof Array}catch(a){}if(!j){b=function(l){var k=new Array(l.length),m=l.length;while(m--){k[m]=l[m]}return k}}function c(l,k){var m=fabric.document.createElement(l);for(var n in k){if(n==="class"){m.className=k[n]}else{if(n==="for"){m.htmlFor=k[n]}else{m.setAttribute(n,k[n])}}}return m}function g(k,l){if((" "+k.className+" ").indexOf(" "+l+" ")===-1){k.className+=(k.className?" ":"")+l}}function f(l,m,k){if(typeof m==="string"){m=c(m,k)}if(l.parentNode){l.parentNode.replaceChild(m,l)}m.appendChild(l);return m}function e(n){var l,q,o={left:0,top:0},p=n&&n.ownerDocument,r={left:0,top:0},m={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!p){return{left:0,top:0}}for(var k in m){r[m[k]]+=parseInt(d(n,k),10)||0}l=p.documentElement;if(typeof n.getBoundingClientRect!=="undefined"){o=n.getBoundingClientRect()}if(p!=null&&p===p.window){q=p}else{q=p.nodeType===9&&(p.defaultView||p.parentWindow)}return{left:o.left+(q.pageXOffset||l.scrollLeft)-(l.clientLeft||0)+r.left,top:o.top+(q.pageYOffset||l.scrollTop)-(l.clientTop||0)+r.top}}function d(l,k){if(!l.style){l.style={}}if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){return fabric.document.defaultView.getComputedStyle(l,null)[k]}else{var m=l.style[k];if(!m&&l.currentStyle){m=l.currentStyle[k]}return m}}(function(){var l=fabric.document.documentElement.style;var m="userSelect" in l?"userSelect":"MozUserSelect" in l?"MozUserSelect":"WebkitUserSelect" in l?"WebkitUserSelect":"KhtmlUserSelect" in l?"KhtmlUserSelect":"";function n(o){if(typeof o.onselectstart!=="undefined"){o.onselectstart=fabric.util.falseFunction}if(m){o.style[m]="none"}else{if(typeof o.unselectable==="string"){o.unselectable="on"}}return o}function k(o){if(typeof o.onselectstart!=="undefined"){o.onselectstart=null}if(m){o.style[m]=""}else{if(typeof o.unselectable==="string"){o.unselectable=""}}return o}fabric.util.makeElementUnselectable=n;fabric.util.makeElementSelectable=k})();(function(){function k(l,p){var n=fabric.document.getElementsByTagName("head")[0],m=fabric.document.createElement("script"),o=true;m.onload=m.onreadystatechange=function(q){if(o){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}o=false;p(q||fabric.window.event);m=m.onload=m.onreadystatechange=null}};m.src=l;n.appendChild(m)}fabric.util.getScript=k})();fabric.util.getById=h;fabric.util.toArray=b;fabric.util.makeElement=c;fabric.util.addClass=g;fabric.util.wrapElement=f;fabric.util.getElementOffset=e;fabric.util.getElementStyle=d})();(function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}var c=(function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var e=h.length;e--;){try{var g=h[e]();if(g){return h[e]}}catch(f){}}})();function a(){}function b(g,f){f||(f={});var j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c(),e;i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){e=null;if(typeof f.parameters==="string"){g=d(g,f.parameters)}}i.open(j,g,true);if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}i.send(e);return i}fabric.util.request=b})();(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(typeof exports!=="undefined"?exports:this);fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){a||(a={});if(a.source){if(typeof a.source==="string"){if(typeof fabric.util.getFunctionBody(a.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(a.source))}else{var b=this;this.source=fabric.util.createImage();fabric.util.loadImage(a.source,function(c){b.source=c})}}else{this.source=a.source}}if(a.repeat){this.repeat=a.repeat}if(a.offsetX){this.offsetX=a.offsetX}if(a.offsetY){this.offsetY=a.offsetY}},toObject:function(){var a;if(typeof this.source==="function"){a=String(this.source)}else{if(typeof this.source.src==="string"){a=this.source.src}}return{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toLive:function(a){var b=typeof this.source==="function"?this.source():this.source;return a.createPattern(b,this.repeat)}});fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,initialize:function(a){for(var b in a){this[b]=a[b]}},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}});(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,f,l,k){var m,i=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(f.x-h.x)*(h.y-l.y)-(f.y-h.y)*(h.x-l.x),g=(k.y-l.y)*(f.x-h.x)-(k.x-l.x)*(f.y-h.y);if(g!==0){var e=i/g,d=j/g;if(0<=e&&e<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+e*(f.x-h.x),h.y+e*(f.y-h.y)))}else{m=new c()}}else{if(i===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}f=d.sourceFromHex(e);if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255,k/=255,n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource();var h=i[0].toString(16);h=(h.length===1)?("0"+h):h;var f=i[1].toString(16);f=(f.length===1)?("0"+f):f;var e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource();for(var g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u;var i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(h){if(h.match(d.reHex)){var k=h.slice(h.indexOf("#")+1),f=(k.length===3),j=f?(k.charAt(0)+k.charAt(0)):k.substring(0,2),i=f?(k.charAt(1)+k.charAt(1)):k.substring(2,4),e=f?(k.charAt(2)+k.charAt(2)):k.substring(4,6);return[parseInt(j,16),parseInt(i,16),parseInt(e,16),1]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,d=fabric.util.removeFromArray,b=fabric.util.removeListener,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(g,f){f||(f={});this._initStatic(g,f);fabric.StaticCanvas.activeInstance=this};e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas.prototype,{backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:true,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:true,stateful:true,renderOnAddition:true,clipTo:null,controlsAboveOverlay:false,onBeforeScaleRotate:function(){},_initStatic:function(g,f){this._objects=[];this._createLowerCanvas(g);this._initOptions(f);if(f.overlayImage){this.setOverlayImage(f.overlayImage,this.renderAll.bind(this))}if(f.backgroundImage){this.setBackgroundImage(f.backgroundImage,this.renderAll.bind(this))}if(f.backgroundColor){this.setBackgroundColor(f.backgroundColor,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(g,h,f){fabric.util.loadImage(g,function(i){this.overlayImage=i;if(f&&("overlayImageLeft" in f)){this.overlayImageLeft=f.overlayImageLeft}if(f&&("overlayImageTop" in f)){this.overlayImageTop=f.overlayImageTop}h&&h()},this);return this},setBackgroundImage:function(g,h,f){fabric.util.loadImage(g,function(i){this.backgroundImage=i;if(f&&("backgroundImageOpacity" in f)){this.backgroundImageOpacity=f.backgroundImageOpacity}if(f&&("backgroundImageStretch" in f)){this.backgroundImageStretch=f.backgroundImageStretch}h&&h()},this);return this},setBackgroundColor:function(f,h){if(f.source){var g=this;fabric.util.loadImage(f.source,function(i){g.backgroundColor=new fabric.Pattern({source:i,repeat:f.repeat});h&&h()})}else{this.backgroundColor=f;h&&h()}return this},_createCanvasElement:function(){var f=fabric.document.createElement("canvas");if(!f.style){f.style={}}if(!f){throw a}this._initCanvasElement(f);return f},_initCanvasElement:function(f){fabric.util.createCanvasElement(f);if(typeof f.getContext==="undefined"){throw a}},_initOptions:function(f){for(var g in f){this[g]=f[g]}this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(f){this.lowerCanvasEl=fabric.util.getById(f)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",f)},setDimensions:function(f){for(var g in f){this._setDimension(g,f[g])}return this},_setDimension:function(g,f){this.lowerCanvasEl[g]=f;this.lowerCanvasEl.style[g]=f+"px";if(this.upperCanvasEl){this.upperCanvasEl[g]=f;this.upperCanvasEl.style[g]=f+"px"}if(this.cacheCanvasEl){this.cacheCanvasEl[g]=f}if(this.wrapperEl){this.wrapperEl.style[g]=f+"px"}this[g]=f;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(g,h){if(!h){return}if(this.controlsAboveOverlay){var f=h.hasBorders,i=h.hasControls;h.hasBorders=h.hasControls=false;h.render(g);h.hasBorders=f;h.hasControls=i}else{h.render(g)}},_onObjectAdded:function(f){this.stateful&&f.setupState();f.setCoords();f.canvas=this;this.fire("object:added",{target:f});f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f});f.fire("removed")},getObjects:function(){return this._objects},clearContext:function(f){f.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(f){var g=this[(f===true&&this.interactive)?"contextTop":"contextContainer"];if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop)}if(!f){this.clearContext(g)}this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,g)}if(this.backgroundColor){g.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(g):this.backgroundColor;g.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)}if(typeof this.backgroundImage==="object"){this._drawBackroundImage(g)}var j=this.getActiveGroup();for(var h=0,k=this._objects.length;h<k;++h){if(!j||(j&&this._objects[h]&&!j.contains(this._objects[h]))){this._draw(g,this._objects[h])}}if(j){var l=[];this.forEachObject(function(i){if(j.contains(i)){l.push(i)}});j._set("objects",l);this._draw(g,j)}if(this.clipTo){g.restore()}if(this.overlayImage){g.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}if(this.controlsAboveOverlay&&this.interactive){this.drawControls(g)}this.fire("after:render");return this},_drawBackroundImage:function(f){f.save();f.globalAlpha=this.backgroundImageOpacity;if(this.backgroundImageStretch){f.drawImage(this.backgroundImage,0,0,this.width,this.height)}else{f.drawImage(this.backgroundImage,0,0)}f.restore()},renderTop:function(){var f=this.contextTop||this.contextContainer;this.clearContext(f);if(this.selection&&this._groupSelector){this._drawSelection()}var g=this.getActiveGroup();if(g){g.render(f)}if(this.overlayImage){f.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){f.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(f){f.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(f){return this.centerObjectH(f).centerObjectV(f)},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,i){var g=this.getActiveGroup();if(g){this.discardActiveGroup()}var h={objects:this.getObjects().map(function(j){var k;if(!this.includeDefaultValues){k=j.includeDefaultValues;j.includeDefaultValues=false}var l=j[f](i);if(!this.includeDefaultValues){j.includeDefaultValues=k}return l},this),background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.backgroundImage){h.backgroundImage=this.backgroundImage.src;h.backgroundImageOpacity=this.backgroundImageOpacity;h.backgroundImageStretch=this.backgroundImageStretch}if(this.overlayImage){h.overlayImage=this.overlayImage.src;h.overlayImageLeft=this.overlayImageLeft;h.overlayImageTop=this.overlayImageTop}fabric.util.populateWithProperties(this,h,i);if(g){this.setActiveGroup(new fabric.Group(g.getObjects()));g.forEachObject(function(j){j.set("active",true)})}return h},remove:function(f){if(this.getActiveObject()===f){this.fire("before:selection:cleared",{target:f});this.discardActiveObject();this.fire("selection:cleared")}return fabric.Collection.remove.call(this,f)},sendToBack:function(f){d(this._objects,f);this._objects.unshift(f);return this.renderAll&&this.renderAll()},bringToFront:function(f){d(this._objects,f);this._objects.push(f);return this.renderAll&&this.renderAll()},sendBackwards:function(j){var g=this._objects.indexOf(j),f=g;if(g!==0){for(var k=g-1;k>=0;--k){var h=j.intersectsWithObject(this._objects[k])||j.isContainedWithinObject(this._objects[k])||this._objects[k].isContainedWithinObject(j);if(h){f=k;break}}d(this._objects,j);this._objects.splice(f,0,j)}return this.renderAll&&this.renderAll()},bringForward:function(k){var n=this.getObjects(),g=n.indexOf(k),f=g;if(g!==n.length-1){for(var m=g+1,j=this._objects.length;m<j;++m){var h=k.intersectsWithObject(n[m])||k.isContainedWithinObject(this._objects[m])||this._objects[m].isContainedWithinObject(k);if(h){f=m;break}}d(n,k);n.splice(f,0,k)}return this.renderAll&&this.renderAll()},moveTo:function(g,f){d(this._objects,g);this._objects.splice(f,0,g);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();if(!this.interactive){return this}if(fabric.isTouchSupported){b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"remove" in Event){Event.remove(this.upperCanvasEl,"gesture",this._onGesture)}}else{b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(fabric.window,"resize",this._onResize)}return this}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(k){var h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),o=f.data,l=f.width,q=f.height,p,g,n,m;for(n=0;n<l;n++){for(m=0;m<q;m++){p=(n*4)*q+(m*4);g=(o[p]+o[p+1]+o[p+2])/3;o[p]=g;o[p+1]=g;o[p+2]=g}}h.putImageData(f,0,0)},supports:function(g){var h=fabric.util.createCanvasElement();if(!h||!h.getContext){return null}var f=h.getContext("2d");if(!f){return null}switch(g){case"getImageData":return typeof f.getImageData!=="undefined";case"setLineDash":return typeof f.setLineDash!=="undefined";case"toDataURL":return typeof h.toDataURL!=="undefined";case"toDataURLWithQuality":try{h.toDataURL("image/jpeg",0);return true}catch(i){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();(function(){var f=fabric.util.object.extend,k=fabric.util.getPointer,c=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,j=Math.atan2,l=Math.abs,e=Math.min,h=Math.max,a=0.5;fabric.Canvas=function(n,m){m||(m={});this._initStatic(n,m);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this};function g(){}g.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new g();var d={uniScaleTransform:false,centerTransform:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(n){var m=this._currentTransform;m.target.set("scaleX",m.original.scaleX);m.target.set("scaleY",m.original.scaleY);m.target.set("left",m.original.left);m.target.set("top",m.original.top);if(n.altKey||this.centerTransform||m.target.centerTransform){if(m.originX!=="center"){if(m.originX==="right"){m.mouseXSign=-1}else{m.mouseXSign=1}}if(m.originY!=="center"){if(m.originY==="bottom"){m.mouseYSign=-1}else{m.mouseYSign=1}}m.originX="center";m.originY="center"}else{m.originX=m.original.originX;m.originY=m.original.originY}},containsPoint:function(o,n){var p=this.getPointer(o),m=this._normalizePointer(n,p);return(n.containsPoint(m)||n._findTargetCorner(o,this._offset))},_normalizePointer:function(n,q){var p=this.getActiveGroup(),m=q.x,r=q.y;var o=(p&&n.type!=="group"&&p.contains(n));if(o){m-=p.left;r-=p.top}return{x:m,y:r}},isTargetTransparent:function(t,v,u){var s=this.contextCache;var n=t.hasBorders,p=t.transparentCorners;t.hasBorders=t.transparentCorners=false;this._draw(s,t);t.hasBorders=n;t.transparentCorners=p;if(this.targetFindTolerance>0){if(v>this.targetFindTolerance){v-=this.targetFindTolerance}else{v=0}if(u>this.targetFindTolerance){u-=this.targetFindTolerance}else{u=0}}var r=true;var m=s.getImageData(v,u,(this.targetFindTolerance*2)||1,(this.targetFindTolerance*2)||1);for(var q=3,o=m.data.length;q<o;q+=4){var w=m.data[q];r=w<=0;if(r===false){break}}m=null;this.clearContext(s);return r},_shouldClearSelection:function(o,n){var m=this.getActiveGroup();return(!n||(n&&m&&!m.contains(n)&&m!==n&&!o.shiftKey)||(n&&!n.selectable))},_setupCurrentTransform:function(r,q){if(!q){return}var p="drag",o,s=k(r,q.canvas.upperCanvasEl);o=q._findTargetCorner(r,this._offset);if(o){p=(o==="ml"||o==="mr")?"scaleX":(o==="mt"||o==="mb")?"scaleY":o==="mtr"?"rotate":"scale"}var n="center",m="center";if(o==="ml"||o==="tl"||o==="bl"){n="right"}else{if(o==="mr"||o==="tr"||o==="br"){n="left"}}if(o==="tl"||o==="mt"||o==="tr"){m="bottom"}else{if(o==="bl"||o==="mb"||o==="br"){m="top"}}if(o==="mtr"){n="center";m="center"}this._currentTransform={target:q,action:p,scaleX:q.scaleX,scaleY:q.scaleY,offsetX:s.x-q.left,offsetY:s.y-q.top,originX:n,originY:m,ex:s.x,ey:s.y,left:q.left,top:q.top,theta:c(q.angle),width:q.width*q.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:q.left,top:q.top,scaleX:q.scaleX,scaleY:q.scaleY,originX:n,originY:m};this._resetCurrentTransform(r)},_shouldHandleGroupLogic:function(o,n){var m=this.getActiveObject();return o.shiftKey&&(this.getActiveGroup()||(m&&m!==n))&&this.selection},_handleGroupLogic:function(r,q){if(q===this.getActiveGroup()){q=this.findTarget(r,true);if(!q||q.isType("group")){return}}var m=this.getActiveGroup();if(m){if(m.contains(q)){m.removeWithUpdate(q);this._resetObjectTransform(m);q.set("active",false);if(m.size()===1){this.discardActiveGroup()}}else{m.addWithUpdate(q);this._resetObjectTransform(m)}this.fire("selection:created",{target:m,e:r});m.set("active",true)}else{if(this._activeObject){if(q!==this._activeObject){var o=this.getObjects();var n=o.indexOf(this._activeObject)<o.indexOf(q);var p=new fabric.Group(n?[q,this._activeObject]:[this._activeObject,q]);this.setActiveGroup(p);m=this.getActiveGroup();this.fire("selection:created",{target:m,e:r})}}q.set("active",true)}if(m){m.saveCoords()}},_translateObject:function(m,o){var n=this._currentTransform.target;if(!n.get("lockMovementX")){n.set("left",m-this._currentTransform.offsetX)}if(!n.get("lockMovementY")){n.set("top",o-this._currentTransform.offsetY)}},_scaleObject:function(z,w,r){var B=this._currentTransform,n=this._offset,p=B.target;var s=p.get("lockScalingX"),q=p.get("lockScalingY");if(s&&q){return}var m=p.translateToOriginPoint(p.getCenterPoint(),B.originX,B.originY);var v=p.toLocalPoint(new fabric.Point(z-n.left,w-n.top),B.originX,B.originY);if(B.originX==="right"){v.x*=-1}else{if(B.originX==="center"){v.x*=B.mouseXSign*2;if(v.x<0){B.mouseXSign=-B.mouseXSign}}}if(B.originY==="bottom"){v.y*=-1}else{if(B.originY==="center"){v.y*=B.mouseYSign*2;if(v.y<0){B.mouseYSign=-B.mouseYSign}}}if(l(v.x)>p.padding){if(v.x<0){v.x+=p.padding}else{v.x-=p.padding}}else{v.x=0}if(l(v.y)>p.padding){if(v.y<0){v.y+=p.padding}else{v.y-=p.padding}}else{v.y=0}var C=p.scaleX,A=p.scaleY;if(r==="equally"&&!s&&!q){var u=v.y+v.x;var o=(p.height+(p.strokeWidth))*B.original.scaleY+(p.width+(p.strokeWidth))*B.original.scaleX;C=B.original.scaleX*u/o;A=B.original.scaleY*u/o;p.set("scaleX",C);p.set("scaleY",A)}else{if(!r){C=v.x/(p.width+p.strokeWidth);A=v.y/(p.height+p.strokeWidth);s||p.set("scaleX",C);q||p.set("scaleY",A)}else{if(r==="x"&&!p.get("lockUniScaling")){C=v.x/(p.width+p.strokeWidth);s||p.set("scaleX",C)}else{if(r==="y"&&!p.get("lockUniScaling")){A=v.y/(p.height+p.strokeWidth);q||p.set("scaleY",A)}}}}if(C<0){if(B.originX==="left"){B.originX="right"}else{if(B.originX==="right"){B.originX="left"}}}if(A<0){if(B.originY==="top"){B.originY="bottom"}else{if(B.originY==="bottom"){B.originY="top"}}}p.setPositionByOrigin(m,B.originX,B.originY)},_rotateObject:function(m,s){var n=this._currentTransform,q=this._offset;if(n.target.get("lockRotation")){return}var p=j(n.ey-n.top-q.top,n.ex-n.left-q.left),r=j(s-n.top-q.top,m-n.left-q.left);n.target.angle=i(r-p+n.theta)},_setCursor:function(m){this.upperCanvasEl.style.cursor=m},_resetObjectTransform:function(m){m.scaleX=1;m.scaleY=1;m.setAngle(0)},_drawSelection:function(){var n=this.contextTop,m=this._groupSelector,t=m.left,s=m.top,r=l(t),p=l(s);n.fillStyle=this.selectionColor;n.fillRect(m.ex-((t>0)?0:-t),m.ey-((s>0)?0:-s),r,p);n.lineWidth=this.selectionLineWidth;n.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var q=m.ex+a-((t>0)?0:r);var o=m.ey+a-((s>0)?0:p);n.beginPath();fabric.util.drawDashedLine(n,q,o,q+r,o,this.selectionDashArray);fabric.util.drawDashedLine(n,q,o+p-1,q+r,o+p-1,this.selectionDashArray);fabric.util.drawDashedLine(n,q,o,q,o+p,this.selectionDashArray);fabric.util.drawDashedLine(n,q+r-1,o,q+r-1,o+p,this.selectionDashArray);n.closePath();n.stroke()}else{n.strokeRect(m.ex+a-((t>0)?0:r),m.ey+a-((s>0)?0:p),r,p)}},_findSelectedObjects:function(q){var w=[],n=this._groupSelector.ex,v=this._groupSelector.ey,m=n+this._groupSelector.left,t=v+this._groupSelector.top,s,r=new fabric.Point(e(n,m),e(v,t)),u=new fabric.Point(h(n,m),h(v,t));for(var o=0,p=this._objects.length;o<p;++o){s=this._objects[o];if(!s){continue}if(s.intersectsWithRect(r,u)||s.isContainedWithinRect(r,u)||s.containsPoint(r)||s.containsPoint(u)){if(this.selection&&s.selectable){s.set("active",true);w.push(s)}}}if(w.length===1){this.setActiveObject(w[0],q)}else{if(w.length>1){w=new fabric.Group(w);this.setActiveGroup(w);w.saveCoords();this.fire("selection:created",{target:w});this.renderAll()}}},findTarget:function(u,p){var v,m=this.getPointer(u);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(u,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(u,this._offset)){v=this.lastRenderedObjectWithControlsAboveOverlay;return v}var o=this.getActiveGroup();if(o&&!p&&this.containsPoint(u,o)){v=o;return v}var n=[];for(var r=this._objects.length;r--;){if(this._objects[r]&&this._objects[r].visible&&this.containsPoint(u,this._objects[r])){if(this.perPixelTargetFind||this._objects[r].perPixelTargetFind){n[n.length]=this._objects[r]}else{v=this._objects[r];this.relatedTarget=v;break}}}for(var q=0,t=n.length;q<t;q++){m=this.getPointer(u);var s=this.isTargetTransparent(n[q],m.x,m.y);if(!s){v=n[q];this.relatedTarget=v;break}}return v},getPointer:function(m){var n=k(m,this.upperCanvasEl);return{x:n.x-this._offset.left,y:n.y-this._offset.top}},_createUpperCanvas:function(){var m=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+m);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var o=this.getWidth()||n.width,m=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:o+"px",height:m+"px",left:0,top:0});n.width=o;n.height=m;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,m){m.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(m,n){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=m;m.set("active",true);this.renderAll();this.fire("object:selected",{target:m,e:n});m.fire("selected",{e:n});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null;return this},setActiveGroup:function(m){this._activeGroup=m;if(m){m.canvas=this;m.set("active",true)}return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var m=this.getActiveGroup();if(m){m.destroy()}return this.setActiveGroup(null)},deactivateAll:function(){var n=this.getObjects(),o=0,m=n.length;for(;o<m;o++){n[o].set("active",false)}this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var m=this.getActiveGroup()||this.getActiveObject();if(m){this.fire("before:selection:cleared",{target:m})}this.deactivateAll();if(m){this.fire("selection:cleared")}return this},drawControls:function(n){var p=this.getActiveGroup();if(p){n.save();fabric.Group.prototype.transform.call(p,n);p.drawBorders(n).drawControls(n);n.restore()}else{for(var o=0,m=this._objects.length;o<m;++o){if(!this._objects[o]||!this._objects[o].active){continue}n.save();fabric.Object.prototype.transform.call(this._objects[o],n);this._objects[o].drawBorders(n).drawControls(n);n.restore();this.lastRenderedObjectWithControlsAboveOverlay=this._objects[o]}}}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;f(fabric.Canvas.prototype,d);for(var b in fabric.StaticCanvas){if(b!=="prototype"){fabric.Canvas[b]=fabric.StaticCanvas[b]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var e=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,d=fabric.util.removeListener,b=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var f=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=function(h,g){f.__onTransformGesture(h,g)};c(fabric.window,"resize",this._onResize);if(fabric.isTouchSupported){c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"add" in Event){Event.add(this.upperCanvasEl,"gesture",this._onGesture)}}else{c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove)}},_onMouseDown:function(f){this.__onMouseDown(f);!fabric.isTouchSupported&&c(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&c(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&c(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&d(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&d(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(f){this.__onMouseUp(f);!fabric.isTouchSupported&&d(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&d(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&d(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&d(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&c(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(f){f.preventDefault&&f.preventDefault();this.__onMouseMove(f)},_onResize:function(){this.calcOffset()},__onMouseUp:function(i){var h;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._isCurrentlyDrawing=false;this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:i});return}if(this._currentTransform){var f=this._currentTransform;h=f.target;if(h._scaling){h._scaling=false}h.isMoving=false;h.setCoords();if(this.stateful&&h.hasStateChanged()){this.fire("object:modified",{target:h});h.fire("modified")}if(this._previousOriginX){this._currentTransform.target.adjustPosition(this._previousOriginX);this._previousOriginX=null}}this._currentTransform=null;if(this.selection&&this._groupSelector){this._findSelectedObjects(i)}var g=this.getActiveGroup();if(g){g.setObjectsCoords();g.set("isMoving",false);this._setCursor(this.defaultCursor)}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(i,h);this._setCursor("");var j=this;setTimeout(function(){j._setCursorFromEvent(i,h)},50);this.fire("mouse:up",{target:h,e:i});h&&h.fire("mouseup",{e:i})},__onMouseDown:function(i){var j;var f="which" in i?i.which===1:i.button===1;if(!f&&!fabric.isTouchSupported){return}if(this.isDrawingMode){j=this.getPointer(i);this._isCurrentlyDrawing=true;this.discardActiveObject().renderAll();this.freeDrawingBrush.onMouseDown(j);this.fire("mouse:down",{e:i});return}if(this._currentTransform){return}var h=this.findTarget(i),g;j=this.getPointer(i);if(this._shouldClearSelection(i,h)){this._groupSelector={ex:j.x,ey:j.y,top:0,left:0};this.deactivateAllWithDispatch();h&&h.selectable&&this.setActiveObject(h,i)}else{if(this._shouldHandleGroupLogic(i,h)){this._handleGroupLogic(i,h);h=this.getActiveGroup()}else{this.stateful&&h.saveState();if((g=h._findTargetCorner(i,this._offset))){this.onBeforeScaleRotate(h)}if(h!==this.getActiveGroup()&&h!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(h,i)}this._setupCurrentTransform(i,h)}}this.renderAll();this.fire("mouse:down",{target:h,e:i});h&&h.fire("mousedown",{e:i});if(g==="mtr"){this._previousOriginX=this._currentTransform.target.originX;this._currentTransform.target.adjustPosition("center");this._currentTransform.left=this._currentTransform.target.left;this._currentTransform.top=this._currentTransform.target.top}},__onMouseMove:function(m){var n,f;if(this.isDrawingMode){if(this._isCurrentlyDrawing){f=this.getPointer(m);this.freeDrawingBrush.onMouseMove(f)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:m});return}var g=this._groupSelector;if(g){f=b(m,this.upperCanvasEl);g.left=f.x-this._offset.left-g.ex;g.top=f.y-this._offset.top-g.ey;this.renderTop()}else{if(!this._currentTransform){var h=this.upperCanvasEl.style;n=this.findTarget(m);if(!n||n&&!n.selectable){for(var k=this._objects.length;k--;){if(this._objects[k]&&!this._objects[k].active){this._objects[k].set("active",false)}}h.cursor=this.defaultCursor}else{this._setCursorFromEvent(m,n)}}else{f=b(m,this.upperCanvasEl);var p=f.x,o=f.y,l=false,j=this._currentTransform;n=j.target;n.isMoving=true;if((j.action==="scale"||j.action==="scaleX"||j.action==="scaleY")&&((m.altKey&&(j.originX!=="center"||j.originY!=="center"))||(!m.altKey&&j.originX==="center"&&j.originY==="center"))){this._resetCurrentTransform(m);l=true}if(j.action==="rotate"){this._rotateObject(p,o);this.fire("object:rotating",{target:n,e:m});n.fire("rotating",{e:m})}else{if(j.action==="scale"){if((m.shiftKey||this.uniScaleTransform)&&!n.get("lockUniScaling")){j.currentAction="scale";this._scaleObject(p,o)}else{if(!l&&j.currentAction==="scale"){this._resetCurrentTransform(m)}j.currentAction="scaleEqually";this._scaleObject(p,o,"equally")}this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{if(j.action==="scaleX"){this._scaleObject(p,o,"x");this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{if(j.action==="scaleY"){this._scaleObject(p,o,"y");this.fire("object:scaling",{target:n,e:m});n.fire("scaling",{e:m})}else{this._translateObject(p,o);this.fire("object:moving",{target:n,e:m});n.fire("moving",{e:m});this._setCursor(this.moveCursor)}}}}this.renderAll()}}this.fire("mouse:move",{target:n,e:m});n&&n.fire("mousemove",{e:m})},_setCursorFromEvent:function(j,i){var g=this.upperCanvasEl.style;if(!i){g.cursor=this.defaultCursor;return false}else{var f=this.getActiveGroup();var h=i._findTargetCorner&&(!f||!f.contains(i))&&i._findTargetCorner(j,this._offset);if(!h){g.cursor=this.hoverCursor}else{if(h in a){var k=Math.round((i.getAngle()%360)/45);if(k<0){k+=8}k+=a[h];k%=8;g.cursor=e[k]}else{if(h==="mtr"&&i.hasRotatingPoint){g.cursor=this.rotationCursor}else{g.cursor=this.defaultCursor;return false}}}}return true}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.set("active",false)},onChange:function(g){b.set("opacity",g);f.renderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",d=a.quality||1,c=a.multiplier||1;if(c!==1){return this.__toDataURLWithMultiplier(b,d,c)}else{return this.__toDataURL(b,d)}},__toDataURL:function(c,d){this.renderAll(true);var a=this.upperCanvasEl||this.lowerCanvasEl;var b=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?a.toDataURL("image/"+c,d):a.toDataURL("image/"+c);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return b},__toDataURLWithMultiplier:function(f,g,j){var h=this.getWidth(),k=this.getHeight(),d=h*j,e=k*j,a=this.getActiveObject(),b=this.getActiveGroup(),i=this.contextTop||this.contextContainer;this.setWidth(d).setHeight(e);i.scale(j,j);if(b){this._tempRemoveBordersControlsFromGroup(b)}else{if(a&&this.deactivateAll){this.deactivateAll()}}this.width=h;this.height=k;this.renderAll(true);var c=this.__toDataURL(f,g);i.scale(1/j,1/j);this.setWidth(h).setHeight(k);if(b){this._restoreBordersControlsOnGroup(b)}else{if(a&&this.setActiveObject){this.setActiveObject(a)}}this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return c},toDataURLWithMultiplier:function(a,c,b){return this.toDataURL({format:a,multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=true;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(b){b.origBorderColor=b.borderColor;b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;a.borderColor=a.origBorderColor;a.forEachObject(function(b){b.borderColor=b.origBorderColor;delete b.origBorderColor})}});(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.degreesToRadians,f=e.StaticCanvas.supports("setLineDash");if(e.Object){return}e.Object=e.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centerTransform:false,fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,stateProperties:("top left width height scaleX scaleY flipX flipY angle opacity cornerSize fill overlayFill originX originY stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable shadow visible").split(" "),initialize:function(h){if(h){this.setOptions(h)}},_initGradient:function(h){if(h.fill&&h.fill.colorStops&&!(h.fill instanceof e.Gradient)){this.set("fill",new e.Gradient(h.fill))}},_initPattern:function(h){if(h.fill&&h.fill.source&&!(h.fill instanceof e.Pattern)){this.set("fill",new e.Pattern(h.fill))}if(h.stroke&&h.stroke.source&&!(h.stroke instanceof e.Pattern)){this.set("stroke",new e.Pattern(h.stroke))}},_initShadow:function(h){if(h.shadow&&!(h.shadow instanceof e.Shadow)){this.setShadow(h.shadow)}},_initClipping:function(h){if(!h.clipTo||typeof h.clipTo!=="string"){return}var i=e.util.getFunctionBody(h.clipTo);if(typeof i!=="undefined"){this.clipTo=new Function("ctx",i)}},setOptions:function(h){for(var i in h){this.set(i,h[i])}this._initGradient(h);this._initPattern(h);this._initShadow(h);this._initClipping(h)},transform:function(i,j){i.globalAlpha=this.opacity;var h=j?this._getLeftTopCoords():this.getCenterPoint();i.translate(h.x,h.y);i.rotate(b(this.angle));i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(j){var i=e.Object.NUM_FRACTION_DIGITS;var h={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo)};if(!this.includeDefaultValues){h=this._removeDefaultValues(h)}e.util.populateWithProperties(this,h,j);return h},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(i){var h=e.Object.prototype.options;if(h){this.stateProperties.forEach(function(j){if(i[j]===h[j]){delete i[j]}})}return i},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(h){return this[h]},set:function(h,i){if(typeof h==="object"){for(var j in h){this._set(j,h[j])}}else{if(typeof i==="function"&&h!=="clipTo"){this._set(h,i(this.get(h)))}else{this._set(h,i)}}return this},_set:function(h,i){var j=(h==="scaleX"||h==="scaleY");if(j){i=this._constrainScale(i)}if(h==="scaleX"&&i<0){this.flipX=!this.flipX;i*=-1}else{if(h==="scaleY"&&i<0){this.flipY=!this.flipY;i*=-1}else{if(h==="width"||h==="height"){this.minScaleLimit=a(Math.min(0.1,1/Math.max(this.width,this.height)),2)}}}this[h]=i;return this},toggle:function(i){var h=this.get(i);if(typeof h==="boolean"){this.set(i,!h)}return this},setSourcePath:function(h){this.sourcePath=h;return this},render:function(i,j){if(this.width===0||this.height===0||!this.visible){return}i.save();var h=this.transformMatrix;if(h&&!this.group){i.setTransform(h[0],h[1],h[2],h[3],h[4],h[5])}if(!j){this.transform(i)}if(this.stroke){i.lineWidth=this.strokeWidth;i.lineCap=this.strokeLineCap;i.lineJoin=this.strokeLineJoin;i.miterLimit=this.strokeMiterLimit;i.strokeStyle=this.stroke.toLive?this.stroke.toLive(i):this.stroke}if(this.overlayFill){i.fillStyle=this.overlayFill}else{if(this.fill){i.fillStyle=this.fill.toLive?this.fill.toLive(i):this.fill}}if(h&&this.group){i.translate(-this.group.width/2,-this.group.height/2);i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}this._setShadow(i);this.clipTo&&e.util.clipContext(this,i);this._render(i,j);this.clipTo&&i.restore();this._removeShadow(i);if(this.active&&!j){this.drawBorders(i);this.drawControls(i)}i.restore()},_setShadow:function(h){if(!this.shadow){return}h.shadowColor=this.shadow.color;h.shadowBlur=this.shadow.blur;h.shadowOffsetX=this.shadow.offsetX;h.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(h){h.shadowColor="";h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_renderFill:function(h){if(!this.fill){return}if(this.fill.toLive){h.save();h.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}h.fill();if(this.fill.toLive){h.restore()}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(h)}},_renderStroke:function(h){if(!this.stroke){return}h.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}if(f){h.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(h)}else{this._renderDashedStroke&&this._renderDashedStroke(h)}h.stroke()}else{this._stroke?this._stroke(h):h.stroke()}this._removeShadow(h);h.restore()},clone:function(i,h){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(h),i)}return new e.Object(this.toObject(h))},cloneAsImage:function(i){var h=this.toDataURL();e.util.loadImage(h,function(j){if(i){i(new e.Image(j))}});return this},toDataURL:function(i){i||(i={});var j=e.util.createCanvasElement();j.width=this.getBoundingRectWidth();j.height=this.getBoundingRectHeight();e.util.wrapElement(j,"div");var h=new e.Canvas(j);if(i.format==="jpeg"){h.backgroundColor="#fff"}var l={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set({active:false,left:j.width/2,top:j.height/2});h.add(this);var k=h.toDataURL(i);this.set(l).setCoords();h.dispose();h=null;return k},isType:function(h){return this.type===h},toGrayscale:function(){var h=this.get("fill");if(h){this.set("overlayFill",new e.Color(h).toGrayscale().toRgb())}return this},complexity:function(){return 0},toJSON:function(h){return this.toObject(h)},setGradient:function(k,j){j||(j={});var l={colorStops:[]};l.type=j.type||(j.r1||j.r2?"radial":"linear");l.coords={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2};if(j.r1||j.r2){l.coords.r1=j.r1;l.coords.r2=j.r2}for(var h in j.colorStops){var i=new e.Color(j.colorStops[h]);l.colorStops.push({offset:h,color:i.toRgb(),opacity:i.getAlpha()})}this.set(k,e.Gradient.forObject(this,l))},setPatternFill:function(h){return this.set("fill",new e.Pattern(h))},setShadow:function(h){return this.set("shadow",new e.Shadow(h))},animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var m=[],l,j;for(l in arguments[0]){m.push(l)}for(var k=0,h=m.length;k<h;k++){l=m[k];j=k!==h-1;this._animate(l,arguments[0][l],arguments[1],j)}}else{this._animate.apply(this,arguments)}return this},_animate:function(l,n,j,h){var m=this,i;n=n.toString();if(!j){j={}}else{j=e.util.object.clone(j)}if(~l.indexOf(".")){i=l.split(".")}var k=i?this.get(i[0])[i[1]]:this.get(l);if(!("from" in j)){j.from=k}if(~n.indexOf("=")){n=k+parseFloat(n.replace("=",""))}else{n=parseFloat(n)}e.util.animate({startValue:j.from,endValue:n,byValue:j.by,easing:j.easing,duration:j.duration,onChange:function(o){if(i){m[i[0]][i[1]]=o}else{m.set(l,o)}if(h){return}j.onChange&&j.onChange()},onComplete:function(){if(h){return}m.setCoords();j.onComplete&&j.onComplete()}})},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){if(this.group){e.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){e.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(){if(this.group){e.StaticCanvas.prototype.sendBackwards.call(this.group,this)}else{this.canvas.sendBackwards(this)}return this},bringForward:function(){if(this.group){e.StaticCanvas.prototype.bringForward.call(this.group,this)}else{this.canvas.bringForward(this)}return this},moveTo:function(h){if(this.group){e.StaticCanvas.prototype.moveTo.call(this.group,this,h)}else{this.canvas.moveTo(this,h)}return this}});e.util.createAccessors(e.Object);e.Object.prototype.rotate=e.Object.prototype.setAngle;g(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,e,d){var b=c.x,f=c.y;if(e==="left"){b=c.x+(this.getWidth()+(this.strokeWidth*this.scaleX))/2}else{if(e==="right"){b=c.x-(this.getWidth()+(this.strokeWidth*this.scaleX))/2}}if(d==="top"){f=c.y+(this.getHeight()+(this.strokeWidth*this.scaleY))/2}else{if(d==="bottom"){f=c.y-(this.getHeight()+(this.strokeWidth*this.scaleY))/2}}return fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},translateToOriginPoint:function(c,e,d){var b=c.x,f=c.y;if(e==="left"){b=c.x-(this.getWidth()+(this.strokeWidth*this.scaleX))/2}else{if(e==="right"){b=c.x+(this.getWidth()+(this.strokeWidth*this.scaleX))/2}}if(d==="top"){f=c.y-(this.getHeight()+(this.strokeWidth*this.scaleY))/2}else{if(d==="bottom"){f=c.y+(this.getHeight()+(this.strokeWidth*this.scaleY))/2}}return fabric.util.rotatePoint(new fabric.Point(b,f),c,a(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(d,f,e){var c=this.getCenterPoint();var b,g;if(f!==undefined&&e!==undefined){if(f==="left"){b=c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2}else{if(f==="right"){b=c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2}else{b=c.x}}if(e==="top"){g=c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2}else{if(e==="bottom"){g=c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2}else{g=c.y}}}else{b=this.left;g=this.top}return fabric.util.rotatePoint(new fabric.Point(d.x,d.y),c,-a(this.angle)).subtractEquals(new fabric.Point(b,g))},setPositionByOrigin:function(f,e,d){var c=this.translateToCenterPoint(f,e,d);var b=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(i){var g=a(this.angle);var h=this.getWidth()/2;var f=Math.cos(g)*h;var c=Math.sin(g)*h;var e=this.getWidth();var d=Math.cos(g)*e;var b=Math.sin(g)*e;if(this.originX==="center"&&i==="left"||this.originX==="right"&&i==="center"){this.left-=f;this.top-=c}else{if(this.originX==="left"&&i==="center"||this.originX==="center"&&i==="right"){this.left+=f;this.top+=c}else{if(this.originX==="left"&&i==="right"){this.left+=d;this.top+=b}else{if(this.originX==="right"&&i==="left"){this.left-=d;this.top-=b}}}}this.setCoords();this.originX=i},_getLeftTopCoords:function(){var e=a(this.angle);var g=this.getWidth()/2;var d=Math.cos(e)*g;var c=Math.sin(e)*g;var b=this.left;var f=this.top;if(this.originX==="center"||this.originX==="right"){b-=d}if(this.originY==="center"||this.originY==="bottom"){f-=c}return{x:b,y:f}}})})();(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{intersectsWithRect:function(c,e){var i=this.oCoords,b=new fabric.Point(i.tl.x,i.tl.y),f=new fabric.Point(i.tr.x,i.tr.y),h=new fabric.Point(i.bl.x,i.bl.y),d=new fabric.Point(i.br.x,i.br.y);var g=fabric.Intersection.intersectPolygonRectangle([b,f,d,h],c,e);return g.status==="Intersection"},intersectsWithObject:function(b){function c(g){return{tl:new fabric.Point(g.tl.x,g.tl.y),tr:new fabric.Point(g.tr.x,g.tr.y),bl:new fabric.Point(g.bl.x,g.bl.y),br:new fabric.Point(g.br.x,g.br.y)}}var d=c(this.oCoords),f=c(b.oCoords);var e=fabric.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[f.tl,f.tr,f.br,f.bl]);return e.status==="Intersection"},isContainedWithinObject:function(b){var c=b.getBoundingRect(),e=new fabric.Point(c.left,c.top),d=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(e,d)},isContainedWithinRect:function(b,d){var c=this.getBoundingRect();return(c.left>b.x&&c.left+c.width<d.x&&c.top>b.y&&c.top+c.height<d.y)},containsPoint:function(b){var d=this._getImageLines(this.oCoords),c=this._findCrossPoints(b,d);return(c!==0&&c%2===1)},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(k,b){var j,i,d,c,h,g,f=0,e;for(var l in b){e=b[l];if((e.o.y<k.y)&&(e.d.y<k.y)){continue}if((e.o.y>=k.y)&&(e.d.y>=k.y)){continue}if((e.o.x===e.d.x)&&(e.o.x>=k.x)){h=e.o.x;g=k.y}else{j=0;i=(e.d.y-e.o.y)/(e.d.x-e.o.x);d=k.y-j*k.x;c=e.o.y-i*e.o.x;h=-(d-c)/(j-i);g=d+j*h}if(h>=k.x){f+=1}if(f===2){break}}return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x];var c=fabric.util.array.min(d);var h=fabric.util.array.max(d);var f=Math.abs(c-h);var e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y];var i=fabric.util.array.min(e);var g=fabric.util.array.max(e);var b=Math.abs(i-g);return{left:c,top:i,width:f,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(b){if(Math.abs(b)<this.minScaleLimit){if(b<0){return -this.minScaleLimit}else{return this.minScaleLimit}}return b},scale:function(b){b=this._constrainScale(b);if(b<0){this.flipX=!this.flipX;this.flipY=!this.flipY;b*=-1}this.scaleX=b;this.scaleY=b;this.setCoords();return this},scaleToWidth:function(c){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/b)},scaleToHeight:function(c){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/b)},setCoords:function(){var k=this.strokeWidth>1?this.strokeWidth:0,i=this.padding,g=a(this.angle);this.currentWidth=(this.width+k)*this.scaleX+i*2;this.currentHeight=(this.height+k)*this.scaleY+i*2;if(this.currentWidth<0){this.currentWidth=Math.abs(this.currentWidth)}var j=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));var h=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);var s=Math.cos(h+g)*j,r=Math.sin(h+g)*j,q=Math.sin(g),l=Math.cos(g);var o=this.getCenterPoint();var e={x:o.x-s,y:o.y-r};var c={x:e.x+(this.currentWidth*l),y:e.y+(this.currentWidth*q)};var t={x:c.x-(this.currentHeight*q),y:c.y+(this.currentHeight*l)};var d={x:e.x-(this.currentHeight*q),y:e.y+(this.currentHeight*l)};var p={x:e.x-(this.currentHeight/2*q),y:e.y+(this.currentHeight/2*l)};var m={x:e.x+(this.currentWidth/2*l),y:e.y+(this.currentWidth/2*q)};var n={x:c.x-(this.currentHeight/2*q),y:c.y+(this.currentHeight/2*l)};var b={x:d.x+(this.currentWidth/2*l),y:d.y+(this.currentWidth/2*q)};var f={x:m.x,y:m.y};this.oCoords={tl:e,tr:c,br:t,bl:d,ml:p,mt:m,mr:n,mb:b,mtr:f};this._setCornerCoords&&this._setCornerCoords();return this}})})();fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this);if(a&&a.stateProperties){a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(j,l){if(!this.hasControls||!this.active){return false}var k=a(j,this.canvas.upperCanvasEl),h=k.x-l.left,f=k.y-l.top,d,c;for(var g in this.oCoords){if(g==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(g==="mt"||g==="mr"||g==="mb"||g==="ml")){continue}c=this._getImageLines(this.oCoords[g].corner);d=this._findCrossPoints({x:h,y:f},c);if(d!==0&&d%2===1){this.__corner=g;return g}}return false},_setCornerCoords:function(){var i=this.oCoords,d=b(this.angle),f=b(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,c=g*Math.cos(f),e=g*Math.sin(f),j=Math.sin(d),h=Math.cos(d);i.tl.corner={tl:{x:i.tl.x-e,y:i.tl.y-c},tr:{x:i.tl.x+c,y:i.tl.y-e},bl:{x:i.tl.x-c,y:i.tl.y+e},br:{x:i.tl.x+e,y:i.tl.y+c}};i.tr.corner={tl:{x:i.tr.x-e,y:i.tr.y-c},tr:{x:i.tr.x+c,y:i.tr.y-e},br:{x:i.tr.x+e,y:i.tr.y+c},bl:{x:i.tr.x-c,y:i.tr.y+e}};i.bl.corner={tl:{x:i.bl.x-e,y:i.bl.y-c},bl:{x:i.bl.x-c,y:i.bl.y+e},br:{x:i.bl.x+e,y:i.bl.y+c},tr:{x:i.bl.x+c,y:i.bl.y-e}};i.br.corner={tr:{x:i.br.x+c,y:i.br.y-e},bl:{x:i.br.x-c,y:i.br.y+e},br:{x:i.br.x+e,y:i.br.y+c},tl:{x:i.br.x-e,y:i.br.y-c}};i.ml.corner={tl:{x:i.ml.x-e,y:i.ml.y-c},tr:{x:i.ml.x+c,y:i.ml.y-e},bl:{x:i.ml.x-c,y:i.ml.y+e},br:{x:i.ml.x+e,y:i.ml.y+c}};i.mt.corner={tl:{x:i.mt.x-e,y:i.mt.y-c},tr:{x:i.mt.x+c,y:i.mt.y-e},bl:{x:i.mt.x-c,y:i.mt.y+e},br:{x:i.mt.x+e,y:i.mt.y+c}};i.mr.corner={tl:{x:i.mr.x-e,y:i.mr.y-c},tr:{x:i.mr.x+c,y:i.mr.y-e},bl:{x:i.mr.x-c,y:i.mr.y+e},br:{x:i.mr.x+e,y:i.mr.y+c}};i.mb.corner={tl:{x:i.mb.x-e,y:i.mb.y-c},tr:{x:i.mb.x+c,y:i.mb.y-e},bl:{x:i.mb.x-c,y:i.mb.y+e},br:{x:i.mb.x+e,y:i.mb.y+c}};i.mtr.corner={tl:{x:i.mtr.x-e+(j*this.rotatingPointOffset),y:i.mtr.y-c-(h*this.rotatingPointOffset)},tr:{x:i.mtr.x+c+(j*this.rotatingPointOffset),y:i.mtr.y-e-(h*this.rotatingPointOffset)},bl:{x:i.mtr.x-c+(j*this.rotatingPointOffset),y:i.mtr.y+e-(h*this.rotatingPointOffset)},br:{x:i.mtr.x+e+(j*this.rotatingPointOffset),y:i.mtr.y+c-(h*this.rotatingPointOffset)}}},drawBorders:function(l){if(!this.hasBorders){return this}var g=this.padding,c=g*2,f=this.strokeWidth>1?this.strokeWidth:0;l.save();l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;l.strokeStyle=this.borderColor;var k=1/this._constrainScale(this.scaleX),i=1/this._constrainScale(this.scaleY);l.lineWidth=1/this.borderScaleFactor;l.scale(k,i);var j=this.getWidth(),e=this.getHeight();l.strokeRect(~~(-(j/2)-g-f/2*this.scaleX)+0.5,~~(-(e/2)-g-f/2*this.scaleY)+0.5,~~(j+c+f*this.scaleX),~~(e+c+f*this.scaleY));if(this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){var d=(this.flipY?e+(f*this.scaleY)+(g*2):-e-(f*this.scaleY)-(g*2))/2;l.beginPath();l.moveTo(0,d);l.lineTo(0,d+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));l.closePath();l.stroke()}l.restore();return this},drawControls:function(p){if(!this.hasControls){return this}var l=this.cornerSize,f=l/2,d=this.strokeWidth>1?(this.strokeWidth/2):0,e=-(this.width/2),j=-(this.height/2),v,q,n=l/this.scaleX,k=l/this.scaleY,s=this.padding/this.scaleX,r=this.padding/this.scaleY,t=f/this.scaleY,u=f/this.scaleX,h=(f-l)/this.scaleX,g=(f-l)/this.scaleY,m=this.height,o=this.width,i=this.transparentCorners?"strokeRect":"fillRect",w=this.transparentCorners,c=typeof G_vmlCanvasManager!=="undefined";p.save();p.lineWidth=1/Math.max(this.scaleX,this.scaleY);p.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;p.strokeStyle=p.fillStyle=this.cornerColor;v=e-u-d-s;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o-u+d+s;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e-u-d-s;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o+h+d+s;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);if(!this.get("lockUniScaling")){v=e+o/2-u;q=j-t-d-r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o/2-u;q=j+m+g+d+r;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e+o+h+d+s;q=j+m/2-t;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k);v=e-u-d-s;q=j+m/2-t;c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k)}if(this.hasRotatingPoint){v=e+o/2-u;q=this.flipY?(j+m+(this.rotatingPointOffset/this.scaleY)-k/2+d+r):(j-(this.rotatingPointOffset/this.scaleY)-k/2-d-r);c||w||p.clearRect(v,q,n,k);p[i](v,q,n,k)}p.restore();return this}})})();(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",initialize:function(g,f){f=f||{};if(!g){g=[0,0,0,0]}this.callSuper("initialize",f);this.set("x1",g[0]);this.set("y1",g[1]);this.set("x2",g[2]);this.set("y2",g[3]);this._setWidthHeight(f)},_setWidthHeight:function(f){f||(f={});this.set("width",Math.abs(this.x2-this.x1)||1);this.set("height",Math.abs(this.y2-this.y1)||1);this.set("left","left" in f?f.left:(Math.min(this.x1,this.x2)+this.width/2));this.set("top","top" in f?f.top:(Math.min(this.y1,this.y2)+this.height/2))},_set:function(f,g){this[f]=g;if(f in a){this._setWidthHeight()}return this},_render:function(g){g.beginPath();var f=this.group&&this.group.type!=="group";if(f&&!this.transformMatrix){g.translate(-this.group.width/2+this.left,-this.group.height/2+this.top)}if(!this.strokeDashArray||this.strokeDashArray&&d){var j=this.x1<=this.x2?-1:1;var h=this.y1<=this.y2?-1:1;g.moveTo(this.width===1?0:(j*this.width/2),this.height===1?0:(h*this.height/2));g.lineTo(this.width===1?0:(j*-1*this.width/2),this.height===1?0:(h*-1*this.height/2))}g.lineWidth=this.strokeWidth;var i=g.strokeStyle;g.strokeStyle=this.stroke||g.fillStyle;this._renderStroke(g);g.strokeStyle=i},_renderDashedStroke:function(g){var f=this.width===1?0:-this.width/2,h=this.height===1?0:-this.height/2;g.beginPath();c.util.drawDashedLine(g,f,h,-f,-h,this.strokeDashArray);g.closePath()},toObject:function(f){return e(this.callSuper("toObject",f),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},complexity:function(){return 1}});c.Line.fromObject=function(f){var g=[f.x1,f.y1,f.x2,f.y2];return new c.Line(g,f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",initialize:function(e){e=e||{};this.set("radius",e.radius||0);this.callSuper("initialize",e);var f=this.get("radius")*2;this.set("width",f).set("height",f)},toObject:function(e){return d(this.callSuper("toObject",e),{radius:this.get("radius")})},_render:function(e,f){e.beginPath();e.globalAlpha=this.group?(e.globalAlpha*this.opacity):this.opacity;e.arc(f?this.left:0,f?this.top:0,this.radius,0,c,false);e.closePath();this._renderFill(e);this._renderStroke(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e;this.set("width",e*2).set("height",e*2)},complexity:function(){return 1}});b.Circle.fromObject=function(e){return new b.Circle(e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath();b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray);b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray);b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray);c.closePath()},complexity:function(){return 1}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},render:function(e,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",e,f)},_render:function(e,f){e.beginPath();e.save();e.globalAlpha=this.group?(e.globalAlpha*this.opacity):this.opacity;if(this.transformMatrix&&this.group){e.translate(this.cx,this.cy)}e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left:0,f?this.top:0,this.rx,0,c,false);this._renderFill(e);this._renderStroke(e);e.restore()},complexity:function(){return 1}});b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect){console.warn("fabric.Rect is already defined");return}b.Rect=b.util.createClass(b.Object,{type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(d){d=d||{};this._initStateProperties();this.callSuper("initialize",d);this._initRxRy();this.x=d.x||0;this.y=d.y||0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(m){var e=this.rx||0,d=this.ry||0,k=-this.width/2,j=-this.height/2,l=this.width,g=this.height,f=this.group&&this.group.type!=="group";m.beginPath();m.globalAlpha=f?(m.globalAlpha*this.opacity):this.opacity;if(this.transformMatrix&&f){m.translate(this.width/2+this.x,this.height/2+this.y)}if(!this.transformMatrix&&f){m.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y)}var i=e!==0||d!==0;m.moveTo(k+e,j);m.lineTo(k+l-e,j);i&&m.quadraticCurveTo(k+l,j,k+l,j+d,k+l,j+d);m.lineTo(k+l,j+g-d);i&&m.quadraticCurveTo(k+l,j+g,k+l-e,j+g,k+l-e,j+g);m.lineTo(k+e,j+g);i&&m.quadraticCurveTo(k,j+g,k,j+g-d,k,j+g-d);m.lineTo(k,j+d);i&&m.quadraticCurveTo(k,j,k+e,j,k+e,j);m.closePath();this._renderFill(m);this._renderStroke(m)},_renderDashedStroke:function(f){var d=-this.width/2,i=-this.height/2,e=this.width,g=this.height;f.beginPath();b.util.drawDashedLine(f,d,i,d+e,i,this.strokeDashArray);b.util.drawDashedLine(f,d+e,i,d+e,i+g,this.strokeDashArray);b.util.drawDashedLine(f,d+e,i+g,d,i+g,this.strokeDashArray);b.util.drawDashedLine(f,d,i+g,d,i,this.strokeDashArray);f.closePath()},_normalizeLeftTopProperties:function(d){if("left" in d){this.set("left",d.left+this.getWidth()/2)}this.set("x",d.left||0);if("top" in d){this.set("top",d.top+this.getHeight()/2)}this.set("y",d.top||0);return this},toObject:function(d){return c(this.callSuper("toObject",d),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")})},complexity:function(){return 1}});b.Rect.fromObject=function(d){return new b.Rect(d)}})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),a=d.util.toFixed,b=d.util.array.min;if(d.Polyline){d.warn("fabric.Polyline is already defined");return}d.Polyline=d.util.createClass(d.Object,{type:"polyline",initialize:function(f,e,g){e=e||{};this.set("points",f);this.callSuper("initialize",e);this._calcDimensions(g)},_calcDimensions:function(e){return d.Polygon.prototype._calcDimensions.call(this,e)},toObject:function(e){return d.Polygon.prototype.toObject.call(this,e)},_render:function(g){var f;g.beginPath();g.moveTo(this.points[0].x,this.points[0].y);for(var h=0,e=this.points.length;h<e;h++){f=this.points[h];g.lineTo(f.x,f.y)}this._renderFill(g);this._renderStroke(g)},_renderDashedStroke:function(f){var j,h;f.beginPath();for(var g=0,e=this.points.length;g<e;g++){j=this.points[g];h=this.points[g+1]||j;d.util.drawDashedLine(f,j.x,j.y,h.x,h.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});d.Polyline.fromObject=function(e){var f=e.points;return new d.Polyline(f,e,true)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(h,g,i){g=g||{};this.points=h;this.callSuper("initialize",g);this._calcDimensions(i)},_calcDimensions:function(l){var i=this.points,h=c(i,"x"),n=c(i,"y"),k=b(i,"x"),j=b(i,"y");this.width=(k-h)||1;this.height=(j-n)||1;this.minX=h;this.minY=n;if(l){return}var m=this.width/2+this.minX,g=this.height/2+this.minY;this.points.forEach(function(o){o.x-=m;o.y-=g},this)},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},_render:function(j){var h;j.beginPath();j.moveTo(this.points[0].x,this.points[0].y);for(var k=0,g=this.points.length;k<g;k++){h=this.points[k];j.lineTo(h.x,h.y)}this._renderFill(j);if(this.stroke||this.strokeDashArray){j.closePath();this._renderStroke(j)}},_renderDashedStroke:function(h){var l,k;h.beginPath();for(var j=0,g=this.points.length;j<g;j++){l=this.points[j];k=this.points[j+1]||this.points[0];e.util.drawDashedLine(h,l.x,l.y,k.x,k.y,this.strokeDashArray)}h.closePath()},complexity:function(){return this.points.length}});e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g,true)}})(typeof exports!=="undefined"?exports:this);(function(a){var h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var c=a.fabric||(a.fabric={}),d=c.util.array.min,f=c.util.array.max,e=c.util.object.extend,b=Object.prototype.toString,g=c.util.drawArc;if(c.Path){c.warn("fabric.Path is already defined");return}function j(k){if(k[0]==="H"){return k[1]}return k[k.length-2]}function i(k){if(k[0]==="V"){return k[1]}return k[k.length-1]}c.Path=c.util.createClass(c.Object,{type:"path",initialize:function(m,l){l=l||{};this.setOptions(l);if(!m){throw new Error("`path` argument is required")}var k=b.call(m)==="[object Array]";this.path=k?m:m.match&&m.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!k){this.path=this._parsePath()}this._initializePath(l);if(l.sourcePath){this.setSourcePath(l.sourcePath)}},_initializePath:function(l){var k="width" in l,n="height" in l,m="left" in l,o="top" in l;if(!k||!n){e(this,this._parseDimensions());if(k){this.width=l.width}if(n){this.height=l.height}}else{if(!o){this.top=this.height/2}if(!m){this.left=this.width/2}}this.pathOffset=this.pathOffset||this._calculatePathOffset(o||m)},_calculatePathOffset:function(k){return{x:k?0:this.left-(this.width/2),y:k?0:this.top-(this.height/2)}},_render:function(B){var v,s=null,z=0,w=0,k=0,C=0,r,q,n,m,o=-((this.width/2)+this.pathOffset.x),A=-((this.height/2)+this.pathOffset.y);for(var p=0,u=this.path.length;p<u;++p){v=this.path[p];switch(v[0]){case"l":z+=v[1];w+=v[2];B.lineTo(z+o,w+A);break;case"L":z=v[1];w=v[2];B.lineTo(z+o,w+A);break;case"h":z+=v[1];B.lineTo(z+o,w+A);break;case"H":z=v[1];B.lineTo(z+o,w+A);break;case"v":w+=v[1];B.lineTo(z+o,w+A);break;case"V":w=v[1];B.lineTo(z+o,w+A);break;case"m":z+=v[1];w+=v[2];B[(s&&(s[0]==="m"||s[0]==="M"))?"lineTo":"moveTo"](z+o,w+A);break;case"M":z=v[1];w=v[2];B[(s&&(s[0]==="m"||s[0]==="M"))?"lineTo":"moveTo"](z+o,w+A);break;case"c":r=z+v[5];q=w+v[6];k=z+v[3];C=w+v[4];B.bezierCurveTo(z+v[1]+o,w+v[2]+A,k+o,C+A,r+o,q+A);z=r;w=q;break;case"C":z=v[5];w=v[6];k=v[3];C=v[4];B.bezierCurveTo(v[1]+o,v[2]+A,k+o,C+A,z+o,w+A);break;case"s":r=z+v[3];q=w+v[4];k=k?(2*z-k):z;C=C?(2*w-C):w;B.bezierCurveTo(k+o,C+A,z+v[1]+o,w+v[2]+A,r+o,q+A);k=z+v[1];C=w+v[2];z=r;w=q;break;case"S":r=v[3];q=v[4];k=2*z-k;C=2*w-C;B.bezierCurveTo(k+o,C+A,v[1]+o,v[2]+A,r+o,q+A);z=r;w=q;k=v[1];C=v[2];break;case"q":r=z+v[3];q=w+v[4];k=z+v[1];C=w+v[2];B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;break;case"Q":r=v[3];q=v[4];B.quadraticCurveTo(v[1]+o,v[2]+A,r+o,q+A);z=r;w=q;k=v[1];C=v[2];break;case"t":r=z+v[1];q=w+v[2];if(s[0].match(/[QqTt]/)===null){k=z;C=w}else{if(s[0]==="t"){k=2*z-n;C=2*w-m}else{if(s[0]==="q"){k=2*z-k;C=2*w-C}}}n=k;m=C;B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;k=z+v[1];C=w+v[2];break;case"T":r=v[1];q=v[2];k=2*z-k;C=2*w-C;B.quadraticCurveTo(k+o,C+A,r+o,q+A);z=r;w=q;break;case"a":g(B,z+o,w+A,[v[1],v[2],v[3],v[4],v[5],v[6]+z+o,v[7]+w+A]);z+=v[6];w+=v[7];break;case"A":g(B,z+o,w+A,[v[1],v[2],v[3],v[4],v[5],v[6]+o,v[7]+A]);z=v[6];w=v[7];break;case"z":case"Z":B.closePath();break}s=v}},render:function(l,n){if(!this.visible){return}l.save();var k=this.transformMatrix;if(k){l.transform(k[0],k[1],k[2],k[3],k[4],k[5])}if(!n){this.transform(l)}if(this.overlayFill){l.fillStyle=this.overlayFill}else{if(this.fill){l.fillStyle=this.fill.toLive?this.fill.toLive(l):this.fill}}if(this.stroke){l.lineWidth=this.strokeWidth;l.lineCap=this.strokeLineCap;l.lineJoin=this.strokeLineJoin;l.miterLimit=this.strokeMiterLimit;l.strokeStyle=this.stroke.toLive?this.stroke.toLive(l):this.stroke}this._setShadow(l);this.clipTo&&c.util.clipContext(this,l);l.beginPath();this._render(l);this._renderFill(l);this._renderStroke(l);this.clipTo&&l.restore();this._removeShadow(l);if(!n&&this.active){this.drawBorders(l);this.drawControls(l)}l.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(l){var k=e(this.callSuper("toObject",l),{path:this.path});if(this.sourcePath){k.sourcePath=this.sourcePath}if(this.transformMatrix){k.transformMatrix=this.transformMatrix}return k},toDatalessObject:function(l){var k=this.toObject(l);if(this.sourcePath){k.path=this.sourcePath}delete k.sourcePath;return k},complexity:function(){return this.path.length},_parsePath:function(){var A=[],v=[],w,t,y=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,q,l;for(var p=0,u,r=this.path.length;p<r;p++){w=this.path[p];l=w.slice(1).trim();v.length=0;while((q=y.exec(l))){v.push(q[0])}u=[w.charAt(0)];for(var o=0,x=v.length;o<x;o++){t=parseFloat(v[o]);if(!isNaN(t)){u.push(t)}}var n=u[0].toLowerCase(),z=h[n];if(u.length-1>z){for(var m=1,s=u.length;m<s;m+=z){A.push([u[0]].concat(u.slice(m,m+z)))}}else{A.push(u)}}return A},_parseDimensions:function(){var u=[],s=[],v,t,w=false,A,z;this.path.forEach(function(x,o){if(x[0]!=="H"){v=(o===0)?j(x):j(this.path[o-1])}if(x[0]!=="V"){t=(o===0)?i(x):i(this.path[o-1])}if(x[0]===x[0].toLowerCase()){w=true}A=w?v+j(x):x[0]==="V"?v:j(x);z=w?t+i(x):x[0]==="H"?t:i(x);var y=parseInt(A,10);if(!isNaN(y)){u.push(y)}y=parseInt(z,10);if(!isNaN(y)){s.push(y)}},this);var p=d(u),n=d(s),l=f(u),k=f(s),r=l-p,q=k-n;var m={left:p+r/2,top:n+q/2,width:r,height:q};return m}});c.Path.fromObject=function(k){return new c.Path(k.path,k)}})(typeof exports!=="undefined"?exports:this);(function(f){var g=f.fabric||(f.fabric={}),h=g.util.object.extend,b=g.util.array.invoke,e=g.Object.prototype.toObject,a=g.util.string.camelize,c=g.util.string.capitalize;if(g.PathGroup){g.warn("fabric.PathGroup is already defined");return}g.PathGroup=g.util.createClass(g.Path,{type:"path-group",fill:"",initialize:function(l,j){j=j||{};this.paths=l||[];for(var k=this.paths.length;k--;){this.paths[k].group=this}this.setOptions(j);this.setCoords();if(j.sourcePath){this.setSourcePath(j.sourcePath)}},render:function(n){if(!this.visible){return}n.save();var j=this.transformMatrix;if(j){n.transform(j[0],j[1],j[2],j[3],j[4],j[5])}this.transform(n);this._setShadow(n);this.clipTo&&g.util.clipContext(this,n);for(var o=0,k=this.paths.length;o<k;++o){this.paths[o].render(n,true)}this.clipTo&&n.restore();this._removeShadow(n);if(this.active){this.drawBorders(n);this.drawControls(n)}n.restore()},_set:function(l,k){if((l==="fill"||l==="overlayFill")&&k&&this.isSameColor()){var j=this.paths.length;while(j--){this.paths[j]._set(l,k)}}return this.callSuper("_set",l,k)},toObject:function(i){return h(e.call(this,i),{paths:b(this.getObjects(),"toObject",i),sourcePath:this.sourcePath})},toDatalessObject:function(j){var i=this.toObject(j);if(this.sourcePath){i.paths=this.sourcePath}return i},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var i=this.getObjects()[0].get("fill");return this.getObjects().every(function(j){return j.get("fill")===i})},complexity:function(){return this.paths.reduce(function(i,j){return i+((j&&j.complexity)?j.complexity():0)},0)},toGrayscale:function(){var j=this.paths.length;while(j--){this.paths[j].toGrayscale()}return this},getObjects:function(){return this.paths}});function d(m){for(var l=0,j=m.length;l<j;l++){if(!(m[l] instanceof g.Object)){var k=a(c(m[l].type));m[l]=g[k].fromObject(m[l])}}return m}g.PathGroup.fromObject=function(i){var j=d(i.paths);return new g.PathGroup(j,i)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(e.Group){return}var f={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(k,h){h=h||{};this._objects=k||[];for(var j=this._objects.length;j--;){this._objects[j].group=this}this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(h){g(this,h)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var i=this.left,h=this.top;this.forEachObject(function(j){var k=j.get("left"),l=j.get("top");j.set("originalLeft",k);j.set("originalTop",l);j.set("left",k-i);j.set("top",l-h);j.setCoords();j.__origHasControls=j.hasControls;j.hasControls=false},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},addWithUpdate:function(h){this._restoreObjectsState();this._objects.push(h);h.group=this;this.forEachObject(function(i){i.set("active",true);i.group=this},this);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(h){this._restoreObjectsState();this.forEachObject(function(i){i.set("active",true);i.group=this},this);this.remove(h);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(h){h.group=this},_onObjectRemoved:function(h){delete h.group;h.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textShadow:true,textAlign:true,backgroundColor:true},_set:function(j,k){if(j in this.delegatedProperties){var h=this._objects.length;this[j]=k;while(h--){this._objects[h].set(j,k)}}else{this[j]=k}},toObject:function(h){return g(this.callSuper("toObject",h),{objects:b(this._objects,"toObject",h)})},render:function(k,p){if(!this.visible){return}k.save();this.transform(k);var o=Math.max(this.scaleX,this.scaleY);this.clipTo&&e.util.clipContext(this,k);for(var m=0,h=this._objects.length;m<h;m++){var l=this._objects[m],n=l.borderScaleFactor,j=l.hasRotatingPoint;if(!l.visible){continue}l.borderScaleFactor=o;l.hasRotatingPoint=false;l.render(k);l.borderScaleFactor=n;l.hasRotatingPoint=j}this.clipTo&&k.restore();if(!p&&this.active){this.drawBorders(k);this.drawControls(k)}k.restore();this.setCoords()},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(j){var k=this.get("left"),l=this.get("top"),h=this.getAngle()*(Math.PI/180),i=Math.cos(h)*j.get("top")*this.get("scaleY")+Math.sin(h)*j.get("left")*this.get("scaleX"),m=-Math.sin(h)*j.get("top")*this.get("scaleY")+Math.cos(h)*j.get("left")*this.get("scaleX");j.setAngle(j.getAngle()+this.getAngle());j.set("left",k+m);j.set("top",l+i);j.set("scaleX",j.get("scaleX")*this.get("scaleX"));j.set("scaleY",j.get("scaleY")*this.get("scaleY"));j.setCoords();j.hasControls=j.__origHasControls;delete j.__origHasControls;j.set("active",false);j.setCoords();delete j.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1;var h=j.every(function(k){return k.get("opacity")===i});if(h){this.opacity=i}},_calcBounds:function(){var s=[],q=[],p,n,k,h,m,l,u,r=0,t=this._objects.length;for(;r<t;++r){m=this._objects[r];m.setCoords();for(var j in m.oCoords){s.push(m.oCoords[j].x);q.push(m.oCoords[j].y)}}p=c(s);k=a(s);n=c(q);h=a(q);l=(k-p)||0;u=(h-n)||0;this.width=l;this.height=u;this.left=(p+l/2)||0;this.top=(n+u/2)||0},get:function(k){if(k in f){if(this[k]){return this[k]}else{for(var j=0,h=this._objects.length;j<h;j++){if(this._objects[j][k]){return true}}return false}}else{if(k in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(k)}return this[k]}}});e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects;i&&i(new e.Group(j,h))})};e.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(d,c){c||(c={});this.callSuper("initialize",c);this._initElement(d);this._originalImage=this.getElement();this._initConfig(c);this.filters=[];if(c.filters){this.filters=c.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(c){this._element=c;this._initConfig();return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},render:function(e,f){if(!this.visible){return}e.save();var c=this.transformMatrix;var d=this.group&&this.group.type!=="group";if(d){e.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2)}if(c){e.transform(c[0],c[1],c[2],c[3],c[4],c[5])}if(!f){this.transform(e)}e.save();this._setShadow(e);this.clipTo&&fabric.util.clipContext(this,e);this._render(e);if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(e)}this._renderStroke(e);this.clipTo&&e.restore();e.restore();if(this.active&&!f){this.drawBorders(e);this.drawControls(e)}e.restore()},_stroke:function(c){c.save();c.lineWidth=this.strokeWidth;c.lineCap=this.strokeLineCap;c.lineJoin=this.strokeLineJoin;c.miterLimit=this.strokeMiterLimit;c.strokeStyle=this.stroke.toLive?this.stroke.toLive(c):this.stroke;c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);c.closePath();c.restore()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save();e.lineWidth=this.strokeWidth;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin;e.miterLimit=this.strokeMiterLimit;e.strokeStyle=this.stroke.toLive?this.stroke.toLive(e):this.stroke;e.beginPath();fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray);e.closePath();e.restore()},toObject:function(c){return b(this.callSuper("toObject",c),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(h){if(this.filters.length===0){this.setElement(this._originalImage);h&&h();return}var f=this._originalImage,d=fabric.util.createCanvasElement(),e=fabric.util.createImage(),g=this;d.width=f.width;d.height=f.height;d.getContext("2d").drawImage(f,0,0,f.width,f.height);this.filters.forEach(function(i){i&&i.applyTo(d)});e.width=f.width;e.height=f.height;if(fabric.isLikelyNode){var c=d.toDataURL("image/png").substring(22);e.src=new Buffer(c,"base64");g._element=e;h&&h()}else{e.onload=function(){g._element=e;h&&h();e.onload=d=f=null};e.src=d.toDataURL("image/png")}return this},_render:function(c){c.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c)},_initFilters:function(c){if(c.filters&&c.filters.length){this.filters=c.filters.map(function(d){return d&&fabric.Image.filters[d.type].fromObject(d)})}},_setWidthHeight:function(c){this.width="width" in c?c.width:(this.getElement().width||0);this.height="height" in c?c.height:(this.getElement().height||0)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(d,f){var c=fabric.document.createElement("img"),e=d.src;if(d.width){c.width=d.width}if(d.height){c.height=d.height}c.onload=function(){fabric.Image.prototype._initFilters.call(d,d);var g=new fabric.Image(c,d);f&&f(g);c=c.onload=c.onerror=null};c.onerror=function(){fabric.log("Error loading "+c.src);f&&f(null,true);c=c.onload=c.onerror=null};c.src=e};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e(new fabric.Image(f,d))})};fabric.Image.async=true})(typeof exports!=="undefined"?exports:this);(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=(oURL.protocol.indexOf("https:")===0)?443:80}var reqHandler=(oURL.port===443)?HTTPS:HTTP;var req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})});req.on("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port)}else{fabric.log(err.message)}});req.end()}function request_fs(url,callback){var fs=require("fs"),stream=fs.createReadStream(url),body="";stream.on("data",function(chunk){body+=chunk});stream.on("end",function(){callback(body)})}fabric.util.loadImage=function(url,callback,context){var createImageAndCallBack=function(data){img.src=new Buffer(data,"binary");img._src=url;callback&&callback.call(context,img)};var img=new Image();if(url&&(url instanceof Buffer||url.indexOf("data")===0)){img.src=img._src=url;callback&&callback.call(context,img)}else{if(url&&url.indexOf("http")!==0){request_fs(url,createImageAndCallBack)}else{if(url){request(url,"binary",createImageAndCallBack)}}}};fabric.loadSVGFromURL=function(url,callback){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(url.indexOf("http")!==0){request_fs(url,function(body){fabric.loadSVGFromString(body,callback)})}else{request(url,"",function(body){fabric.loadSVGFromString(body,callback)})}};fabric.loadSVGFromString=function(string,callback){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options)})};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object);callback(oImg)})};fabric.createCanvasForNode=function(width,height){var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas;var fabricCanvas=new FabricCanvas(canvasEl);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width){origSetWidth.call(this,width);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height){origSetHeight.call(this,height);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();